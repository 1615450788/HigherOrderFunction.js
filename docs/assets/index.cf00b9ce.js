var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,c=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&i(e,n,t[n]);if(r)for(var n of r(t))s.call(t,n)&&i(e,n,t[n]);return e};export function __vite_legacy_guard(){import("data:text/javascript,")}import{h as l,e as a,i as u,a as p,l as m,r as h,R as f,b as d,c as y}from"./vendor.449db6c8.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const g=(e,t={})=>l(e,c({algorithm:"md5"},t)),E=(e,t)=>{const{params:n=((...e)=>e),key:r=((...e)=>g(e,t)),storage:o=new Map,debug:s=!1}=t||{};return async(...t)=>{const i=await r(...await n(...t)),c=await o.get(i);if(c)return s&&console.log("Cache found",{cacheKey:i,cacheValue:c}),c;{s&&console.log("Cache not found",{cacheKey:i});const n=await e(...t);return await o.set(i,n),n}}};function v(e){if(!(this instanceof v))return new v(e);a.exports.EventEmitter.call(this),e=e||{},this.concurrency=e.concurrency||1/0,this.timeout=e.timeout||0,this.autostart=e.autostart||!1,this.results=e.results||null,this.pending=0,this.session=0,this.running=!1,this.jobs=[],this.timers={}}(u||p)(v,a.exports.EventEmitter),window.module&&(module.exports=v);["pop","shift","indexOf","lastIndexOf"].forEach((function(e){v.prototype[e]=function(){return Array.prototype[e].apply(this.jobs,arguments)}})),v.prototype.slice=function(e,t){return this.jobs=this.jobs.slice(e,t),this},v.prototype.reverse=function(){return this.jobs.reverse(),this};function b(){for(var e in this.timers){var t=this.timers[e];delete this.timers[e],clearTimeout(t)}}function w(e){var t=this;function n(e){t.end(e)}this.on("error",n),this.on("end",(function r(o){t.removeListener("error",n),t.removeListener("end",r),e(o,this.results)}))}function x(e){this.session++,this.running=!1,this.emit("end",e)}["push","unshift","splice"].forEach((function(e){v.prototype[e]=function(){var t=Array.prototype[e].apply(this.jobs,arguments);return this.autostart&&this.start(),t}})),Object.defineProperty(v.prototype,"length",{get:function(){return this.pending+this.jobs.length}}),v.prototype.start=function(e){if(e&&w.call(this,e),this.running=!0,!(this.pending>=this.concurrency))if(0!==this.jobs.length){var t=this,n=this.jobs.shift(),r=!0,o=this.session,s=null,i=!1,c=null,l=n.hasOwnProperty("timeout")?n.timeout:this.timeout;l&&(s=setTimeout((function(){i=!0,t.listeners("timeout").length>0?t.emit("timeout",u,n):u()}),l),this.timers[s]=s),this.results&&(c=this.results.length,this.results[c]=null),this.pending++,t.emit("start",n);var a=n(u);a&&a.then&&"function"==typeof a.then&&a.then((function(e){return u(null,e)})).catch((function(e){return u(e||!0)})),this.running&&this.jobs.length>0&&this.start()}else 0===this.pending&&x.call(this);function u(e,l){r&&t.session===o&&(r=!1,t.pending--,null!==s&&(delete t.timers[s],clearTimeout(s)),e?t.emit("error",e,n):!1===i&&(null!==c&&(t.results[c]=Array.prototype.slice.call(arguments,1)),t.emit("success",l,n)),t.session===o&&(0===t.pending&&0===t.jobs.length?x.call(t):t.running&&t.start()))}},v.prototype.stop=function(){this.running=!1},v.prototype.end=function(e){b.call(this),this.jobs.length=0,this.pending=0,x.call(this,e)};const j=(e,t)=>{const{concurrency:n=6,failAbort:r=!0,debug:o=!1,elastic:{enable:s=!1,idealDuration:i=1e4}={}}=t||{},c=new v({concurrency:s?1:n,autostart:!0});s&&n>1&&(c.on("start",(e=>{e._startTime=Number(new Date),e._concurrency=c.concurrency})),c.on("success",((e,t)=>{if(t._concurrency!==c.concurrency)return;const r=Number(new Date)-t._startTime;let s=c.concurrency;m.exports.inRange(r,.9*i,1.1*i)||(r<i?s++:s--,s=m.exports.clamp(s,1,n),c.concurrency!==s&&(c.concurrency=s),o&&console.log("queueWarpper success",{duration:r,start:t._startTime,nowConcurrency:s}))})));let l=()=>{};return r&&(l=()=>{o&&console.log("queueWarpper error",c),c.end()}),c.start(),(...t)=>new Promise(((n,r)=>{c.push((async()=>{try{const r=await e(...t);n(r)}catch(o){l(),r(o)}}))}))};function O(e,r){const{debug:o=!1,retries:s=2}=r||{};var i,l=h.operation((i=c({},r),t(i,n({retries:s}))));return(...t)=>new Promise(((n,r)=>{l.attempt((async()=>{try{const r=l.attempts();r>1&&o&&console.log("任务执行失败，正在重试，当前重试次数:",r-1,"; 最大重试次数：",s);const i=await e(...t);n(i)}catch(i){if(l.retry(i))return;r(l.errors())}}))}))}function P(){const[e,t]=y.exports.useState(0),[n,r]=y.exports.useState(0);return y.exports.useEffect((()=>{O((()=>{const e=Math.random();if(t((e=>e+1)),e>.9)return e;throw new Error}),{retries:99,factor:1,maxTimeout:1e3})().then((e=>r(e)))}),[]),d.createElement("div",null,d.createElement("h2",null,"Retry"),d.createElement("div",null,"const fn = retryWarpper(() => {"),d.createElement("div",null,"const x = Math.random();"),d.createElement("div",null,"if(x > 0.9){return x}else{throw new Error()}"),d.createElement("div",null,"}, { debug: true, retries: 99, factor: 1, maxTimeout: 1000 })"),d.createElement("div",null,"console.log(await fn())"),d.createElement("div",null,"重试次数:",e),d.createElement("div",null,"执行结果:",n||"执行中"))}function W(){const[e,t]=y.exports.useState(0),[n,r]=y.exports.useState([]);return y.exports.useEffect((()=>{const e=+new Date,n=j((()=>new Promise((n=>setTimeout((()=>{t((e=>e+1)),r((t=>[...t,+new Date-e])),n()}),1e3)))),{concurrency:1});Promise.all([n(),n(),n(),n()])}),[]),d.createElement("div",null,d.createElement("h2",null,"Queue"),d.createElement("div",null,"const originFn = ()=> new Promise(r => setTimeout(()=>{console.log('完成一个');r()},1000))"),d.createElement("div",null,"const fn = queueWarpper(originFn,{ concurrency: 1 })"),d.createElement("div",null,"fn();fn();fn();fn();"),d.createElement("div",null,"当前执行任务索引:",e),d.createElement("div",null,"任务完成时间:"),n.map(((e,t)=>d.createElement("div",{key:e},t+1,":",e))))}function T(){const[e,t]=y.exports.useState(0),[n,r]=y.exports.useState(0);return y.exports.useEffect((()=>{const e=E(((e,n)=>(t((e=>e+1)),e+n)),{concurrency:1});setInterval((()=>{r((e=>e+1)),e(1,2)}),1e3)}),[]),d.createElement("div",null,d.createElement("h2",null,"Cache"),d.createElement("div",null,"const fn = cacheWarpper((a,b)=> {"),d.createElement("div",null,"var x =a+b;console.log(x);return x})"),d.createElement("div",null,"setInterval(() => fn(1, 2),1000)"),d.createElement("div",null,"实际运行次数:",e),d.createElement("div",null,"调用次数:",n))}function _(){return d.createElement("div",null,d.createElement("h1",null,"high-order-function.js"),d.createElement("div",{style:{display:"flex",width:"100%",justifyContent:"space-between"}},d.createElement(P,null),d.createElement(W,null),d.createElement(T,null)),d.createElement("br",null),d.createElement("br",null),d.createElement("br",null),d.createElement("br",null),d.createElement("br",null),d.createElement("br",null),d.createElement("div",null,"复制代码到控制台试试？retryWarpper, queueWarpper, cacheWarpper "))}window.retryWarpper=O,window.queueWarpper=j,window.cacheWarpper=E,f.render(d.createElement(_,null),document.getElementById("root"));
