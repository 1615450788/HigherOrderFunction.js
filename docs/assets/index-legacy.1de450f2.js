!function(){function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],u=!0,c=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);u=!0);}catch(a){c=!0,o=a}finally{try{u||null==n.return||n.return()}finally{if(c)throw o}}return i}(e,t)||c(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t,n,r,o,i,u){try{var c=e[i](u),a=c.value}catch(s){return void n(s)}c.done?t(a):Promise.resolve(a).then(r,o)}function r(e){return function(){var t=this,r=arguments;return new Promise((function(o,i){var u=e.apply(t,r);function c(e){n(u,o,i,c,a,"next",e)}function a(e){n(u,o,i,c,a,"throw",e)}c(void 0)}))}}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s=document.createElement("style");s.innerHTML="#root{font-family:Avenir,Helvetica,Arial,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-align:center;color:#2c3e50;margin-top:60px}\n",document.head.appendChild(s),System.register(["./vendor-legacy.46b08d13.js"],(function(){"use strict";var n,o,u,c,a,s,l,f,p;return{setters:[function(e){n=e.h,o=e.e,u=e.i,c=e.a,a=e.l,s=e.r,l=e.R,f=e.b,p=e.c}],execute:function(){var h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n(e,i({algorithm:"md5"},t))},m=function(e,n){var o=n||{},i=o.params,u=void 0===i?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t}:i,c=o.key,a=void 0===c?function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return h(t,n)}:c,s=o.storage,l=void 0===s?new Map:s,f=o.debug,p=void 0!==f&&f;return r(regeneratorRuntime.mark((function n(){var r,o,i,c=arguments;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=a,n.t1=void 0,n.t2=t,n.next=5,u.apply(void 0,c);case 5:return n.t3=n.sent,n.t4=(0,n.t2)(n.t3),n.next=9,n.t0.apply.call(n.t0,n.t1,n.t4);case 9:return r=n.sent,n.next=12,l.get(r);case 12:if(!(o=n.sent)){n.next=18;break}return p&&console.log("Cache found",{cacheKey:r,cacheValue:o}),n.abrupt("return",o);case 18:return p&&console.log("Cache not found",{cacheKey:r}),n.next=21,e.apply(void 0,c);case 21:return i=n.sent,n.next=24,l.set(r,i);case 24:return n.abrupt("return",i);case 25:case"end":return n.stop()}}),n)})))};function d(e){if(!(this instanceof d))return new d(e);o.exports.EventEmitter.call(this),e=e||{},this.concurrency=e.concurrency||1/0,this.timeout=e.timeout||0,this.autostart=e.autostart||!1,this.results=e.results||null,this.pending=0,this.session=0,this.running=!1,this.jobs=[],this.timers={}}(u||c)(d,o.exports.EventEmitter),window.module&&(module.exports=d);["pop","shift","indexOf","lastIndexOf"].forEach((function(e){d.prototype[e]=function(){return Array.prototype[e].apply(this.jobs,arguments)}})),d.prototype.slice=function(e,t){return this.jobs=this.jobs.slice(e,t),this},d.prototype.reverse=function(){return this.jobs.reverse(),this};function v(){for(var e in this.timers){var t=this.timers[e];delete this.timers[e],clearTimeout(t)}}function y(e){var t=this;function n(e){t.end(e)}this.on("error",n),this.on("end",(function r(o){t.removeListener("error",n),t.removeListener("end",r),e(o,this.results)}))}function g(e){this.session++,this.running=!1,this.emit("end",e)}["push","unshift","splice"].forEach((function(e){d.prototype[e]=function(){var t=Array.prototype[e].apply(this.jobs,arguments);return this.autostart&&this.start(),t}})),Object.defineProperty(d.prototype,"length",{get:function(){return this.pending+this.jobs.length}}),d.prototype.start=function(e){if(e&&y.call(this,e),this.running=!0,!(this.pending>=this.concurrency))if(0!==this.jobs.length){var t=this,n=this.jobs.shift(),r=!0,o=this.session,i=null,u=!1,c=null,a=n.hasOwnProperty("timeout")?n.timeout:this.timeout;a&&(i=setTimeout((function(){u=!0,t.listeners("timeout").length>0?t.emit("timeout",l,n):l()}),a),this.timers[i]=i),this.results&&(c=this.results.length,this.results[c]=null),this.pending++,t.emit("start",n);var s=n(l);s&&s.then&&"function"==typeof s.then&&s.then((function(e){return l(null,e)})).catch((function(e){return l(e||!0)})),this.running&&this.jobs.length>0&&this.start()}else 0===this.pending&&g.call(this);function l(e,a){r&&t.session===o&&(r=!1,t.pending--,null!==i&&(delete t.timers[i],clearTimeout(i)),e?t.emit("error",e,n):!1===u&&(null!==c&&(t.results[c]=Array.prototype.slice.call(arguments,1)),t.emit("success",a,n)),t.session===o&&(0===t.pending&&0===t.jobs.length?g.call(t):t.running&&t.start()))}},d.prototype.stop=function(){this.running=!1},d.prototype.end=function(e){v.call(this),this.jobs.length=0,this.pending=0,g.call(this,e)};var b=function(e,t){var n=t||{},o=n.concurrency,i=void 0===o?6:o,u=n.failAbort,c=void 0===u||u,s=n.debug,l=void 0!==s&&s,f=n.elastic,p=(f=void 0===f?{}:f).enable,h=void 0!==p&&p,m=f.idealDuration,v=void 0===m?1e4:m,y=new d({concurrency:h?1:i,autostart:!0});h&&i>1&&(y.on("start",(function(e){e._startTime=Number(new Date),e._concurrency=y.concurrency})),y.on("success",(function(e,t){if(t._concurrency===y.concurrency){var n=Number(new Date)-t._startTime,r=y.concurrency;a.exports.inRange(n,.9*v,1.1*v)||(n<v?r++:r--,r=a.exports.clamp(r,1,i),y.concurrency!==r&&(y.concurrency=r),l&&console.log("queueWarpper success",{duration:n,start:t._startTime,nowConcurrency:r}))}})));var g=function(){};return c&&(g=function(){l&&console.log("queueWarpper error",y),y.end()}),y.start(),function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return new Promise((function(t,o){y.push(r(regeneratorRuntime.mark((function r(){var i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.apply(void 0,n);case 3:i=r.sent,t(i),r.next=11;break;case 7:r.prev=7,r.t0=r.catch(0),g(),o(r.t0);case 11:case"end":return r.stop()}}),r,null,[[0,7]])}))))}))}};function E(e,t){var n=t||{},o=n.debug,u=void 0!==o&&o,c=n.retries,a=void 0===c?2:c,l=s.operation(i(i({},t),{},{retries:a}));return function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return new Promise((function(t,o){l.attempt(r(regeneratorRuntime.mark((function r(){var i,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,(i=l.attempts())>1&&u&&console.log("任务执行失败，正在重试，当前重试次数:",i-1,"; 最大重试次数：",a),r.next=5,e.apply(void 0,n);case 5:c=r.sent,t(c),r.next=14;break;case 9:if(r.prev=9,r.t0=r.catch(0),!l.retry(r.t0)){r.next=13;break}return r.abrupt("return");case 13:o(l.errors());case 14:case"end":return r.stop()}}),r,null,[[0,9]])}))))}))}}function w(){var t=e(p.exports.useState(0),2),n=t[0],r=t[1],o=e(p.exports.useState(0),2),i=o[0],u=o[1];return p.exports.useEffect((function(){var e=E((function(){var e=Math.random();if(r((function(e){return e+1})),e>.9)return e;throw new Error}),{retries:99,factor:1,maxTimeout:1e3});e().then((function(e){return u(e)}))}),[]),f.createElement("div",null,f.createElement("h2",null,"Retry"),f.createElement("div",null,"const fn = retryWarpper(() => {"),f.createElement("div",null,"const x = Math.random();"),f.createElement("div",null,"if(x > 0.9){return x}else{throw new Error()}"),f.createElement("div",null,"}, { debug: true, retries: 99, factor: 1, maxTimeout: 1000 })"),f.createElement("div",null,"console.log(await fn())"),f.createElement("div",null,"重试次数:",n),f.createElement("div",null,"执行结果:",i||"执行中"))}function x(){var n=e(p.exports.useState(0),2),r=n[0],o=n[1],i=e(p.exports.useState([]),2),u=i[0],c=i[1];return p.exports.useEffect((function(){var e=+new Date,n=b((function(){return new Promise((function(n){return setTimeout((function(){o((function(e){return e+1})),c((function(n){return[].concat(t(n),[+new Date-e])})),n()}),1e3)}))}),{concurrency:1});Promise.all([n(),n(),n(),n()])}),[]),f.createElement("div",null,f.createElement("h2",null,"Queue"),f.createElement("div",null,"const originFn = ()=> new Promise(r => setTimeout(()=>{console.log('完成一个');r()},1000))"),f.createElement("div",null,"const fn = queueWarpper(originFn,{ concurrency: 1 })"),f.createElement("div",null,"fn();fn();fn();fn();"),f.createElement("div",null,"当前执行任务索引:",r),f.createElement("div",null,"任务完成时间:"),u.map((function(e,t){return f.createElement("div",{key:e},t+1,":",e)})))}function j(){var t=e(p.exports.useState(0),2),n=t[0],r=t[1],o=e(p.exports.useState(0),2),i=o[0],u=o[1];return p.exports.useEffect((function(){var e=m((function(e,t){return r((function(e){return e+1})),e+t}),{concurrency:1});setInterval((function(){u((function(e){return e+1})),e(1,2)}),1e3)}),[]),f.createElement("div",null,f.createElement("h2",null,"Cache"),f.createElement("div",null,"const fn = cacheWarpper((a,b)=> {"),f.createElement("div",null,"var x =a+b;console.log(x);return x})"),f.createElement("div",null,"setInterval(() => fn(1, 2),1000)"),f.createElement("div",null,"实际运行次数:",n),f.createElement("div",null,"调用次数:",i))}function O(){return f.createElement("div",null,f.createElement("h1",null,"high-order-function.js"),f.createElement("div",{style:{display:"flex",width:"100%",justifyContent:"space-between"}},f.createElement(w,null),f.createElement(x,null),f.createElement(j,null)),f.createElement("br",null),f.createElement("br",null),f.createElement("br",null),f.createElement("br",null),f.createElement("br",null),f.createElement("br",null),f.createElement("div",null,"复制代码到控制台试试？retryWarpper, queueWarpper, cacheWarpper "))}window.retryWarpper=E,window.queueWarpper=b,window.cacheWarpper=m,l.render(f.createElement(O,null),document.getElementById("root"))}}}))}();
